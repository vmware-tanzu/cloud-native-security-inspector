
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.4.1
  creationTimestamp: null
  name: assessmentreports.goharbor.goharbor.io
spec:
  group: goharbor.goharbor.io
  names:
    kind: AssessmentReport
    listKind: AssessmentReportList
    plural: assessmentreports
    singular: assessmentreport
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: AssessmentReport is the Schema for the assessmentreports API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: AssessmentReportSpec defines the desired state of AssessmentReport
            properties:
              inspectionConfiguration:
                description: InspectionConfiguration refers tp the inspection configuration
                  defined in the InspectionPolicy.
                properties:
                  actions:
                    description: Actions of protection.
                    items:
                      description: FollowupAction defines what actions should be applied
                        when security expectations are matched.
                      properties:
                        ignore:
                          description: Ignore applying actions to the workloads with
                            the specified labels.
                          properties:
                            matchExpressions:
                              description: matchExpressions is a list of label selector
                                requirements. The requirements are ANDed.
                              items:
                                description: A label selector requirement is a selector
                                  that contains values, a key, and an operator that
                                  relates the key and values.
                                properties:
                                  key:
                                    description: key is the label key that the selector
                                      applies to.
                                    type: string
                                  operator:
                                    description: operator represents a key's relationship
                                      to a set of values. Valid operators are In,
                                      NotIn, Exists and DoesNotExist.
                                    type: string
                                  values:
                                    description: values is an array of string values.
                                      If the operator is In or NotIn, the values array
                                      must be non-empty. If the operator is Exists
                                      or DoesNotExist, the values array must be empty.
                                      This array is replaced during a strategic merge
                                      patch.
                                    items:
                                      type: string
                                    type: array
                                required:
                                - key
                                - operator
                                type: object
                              type: array
                            matchLabels:
                              additionalProperties:
                                type: string
                              description: matchLabels is a map of {key,value} pairs.
                                A single {key,value} in the matchLabels map is equivalent
                                to an element of matchExpressions, whose key field
                                is "key", the operator is "In", and the values array
                                contains only "value". The requirements are ANDed.
                              type: object
                          type: object
                        kind:
                          description: Kind of action.
                          enum:
                          - forbid_vulnerable_deployment
                          - quarantine_vulnerable_workload
                          - alert
                          type: string
                        settings:
                          additionalProperties:
                            type: string
                          description: Settings of the action.
                          type: object
                      required:
                      - kind
                      type: object
                    type: array
                  assessment:
                    description: DataProvider is the data provider. DataProvider DataProvider
                      `json:"dataProvider"` Assessment is the assessment report.
                    properties:
                      elasticSearchAddr:
                        description: ElasticSearch endpoint
                        type: string
                      elasticSearchCert:
                        description: ElasticSearch certificate for the client
                        type: string
                      elasticSearchEnabled:
                        default: false
                        description: Indicate whether to store the reports to elasticsearch
                        type: boolean
                      elasticSearchPasswd:
                        description: ElasticSearch password for the client
                        type: string
                      elasticSearchUser:
                        description: ElasticSearch username for the client
                        type: string
                      format:
                        default: YAML
                        description: Format of the assessment report data.
                        enum:
                        - JSON
                        - YAML
                        type: string
                      generate:
                        default: true
                        description: Generate indicates whether generate the assessment
                          report or not.
                        type: boolean
                      liveTime:
                        default: 86400
                        description: Live time of the generated report. Unit is second.
                        format: int64
                        type: integer
                      managedBy:
                        default: false
                        description: Indicate whether the assessment reports are managed
                          by the policy. If it is set to true, then the assessment
                          report is owned by the policy.
                        type: boolean
                      openSearchAddr:
                        description: ElasticSearch endpoint
                        type: string
                      openSearchCert:
                        description: ElasticSearch certificate for the client
                        type: string
                      openSearchEnabled:
                        default: false
                        description: Indicate whether to store the reports to opensearch
                        type: boolean
                      openSearchPasswd:
                        description: ElasticSearch password for the client
                        type: string
                      openSearchUser:
                        description: ElasticSearch username for the client
                        type: string
                    required:
                    - elasticSearchEnabled
                    - format
                    - generate
                    - liveTime
                    - managedBy
                    - openSearchEnabled
                    type: object
                  baselines:
                    description: Baselines of cluster compliance.
                    items:
                      description: ComplianceBaseline defines the expecting compliance
                        baseline.
                      properties:
                        baseline:
                          description: Baseline for the compliance of this kind.
                          type: string
                        kind:
                          description: Kind of inspector.
                          enum:
                          - vulnerability
                          - malware
                          - misconfiguration
                          - license
                          - BOM
                          type: string
                        scheme:
                          description: Scheme of data.
                          type: string
                        version:
                          description: Version of data scheme used for the compliance
                            check.
                          type: string
                      required:
                      - baseline
                      - kind
                      - scheme
                      - version
                      type: object
                    minItems: 1
                    type: array
                  namespaceSelector:
                    description: NamespaceSelector provides a way to select the specified
                      namespaces.
                    properties:
                      matchExpressions:
                        description: matchExpressions is a list of label selector
                          requirements. The requirements are ANDed.
                        items:
                          description: A label selector requirement is a selector
                            that contains values, a key, and an operator that relates
                            the key and values.
                          properties:
                            key:
                              description: key is the label key that the selector
                                applies to.
                              type: string
                            operator:
                              description: operator represents a key's relationship
                                to a set of values. Valid operators are In, NotIn,
                                Exists and DoesNotExist.
                              type: string
                            values:
                              description: values is an array of string values. If
                                the operator is In or NotIn, the values array must
                                be non-empty. If the operator is Exists or DoesNotExist,
                                the values array must be empty. This array is replaced
                                during a strategic merge patch.
                              items:
                                type: string
                              type: array
                          required:
                          - key
                          - operator
                          type: object
                        type: array
                      matchLabels:
                        additionalProperties:
                          type: string
                        description: matchLabels is a map of {key,value} pairs. A
                          single {key,value} in the matchLabels map is equivalent
                          to an element of matchExpressions, whose key field is "key",
                          the operator is "In", and the values array contains only
                          "value". The requirements are ANDed.
                        type: object
                    type: object
                  workloadSelector:
                    description: WorkloadSelector provides a way to select the specified
                      workloads.
                    properties:
                      matchExpressions:
                        description: matchExpressions is a list of label selector
                          requirements. The requirements are ANDed.
                        items:
                          description: A label selector requirement is a selector
                            that contains values, a key, and an operator that relates
                            the key and values.
                          properties:
                            key:
                              description: key is the label key that the selector
                                applies to.
                              type: string
                            operator:
                              description: operator represents a key's relationship
                                to a set of values. Valid operators are In, NotIn,
                                Exists and DoesNotExist.
                              type: string
                            values:
                              description: values is an array of string values. If
                                the operator is In or NotIn, the values array must
                                be non-empty. If the operator is Exists or DoesNotExist,
                                the values array must be empty. This array is replaced
                                during a strategic merge patch.
                              items:
                                type: string
                              type: array
                          required:
                          - key
                          - operator
                          type: object
                        type: array
                      matchLabels:
                        additionalProperties:
                          type: string
                        description: matchLabels is a map of {key,value} pairs. A
                          single {key,value} in the matchLabels map is equivalent
                          to an element of matchExpressions, whose key field is "key",
                          the operator is "In", and the values array contains only
                          "value". The requirements are ANDed.
                        type: object
                    type: object
                required:
                - assessment
                - baselines
                type: object
              namespaceAssessments:
                description: Assessments are the assessment results.
                items:
                  description: NamespaceAssessment defines assessment results for
                    each Namespace.
                  properties:
                    namespace:
                      description: Which namespace?
                      properties:
                        name:
                          description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                            TODO: Add other useful fields. apiVersion, kind, uid?'
                          type: string
                      type: object
                    workloadAssessments:
                      description: Assessments contains results of namespace assessments.
                      items:
                        description: WorkloadAssessment defines assessment results
                          for each Workload.
                        properties:
                          actionEnforcements:
                            description: ActionEnforcements indicates what actions
                              are enforced? Only when passed failed and actions are
                              defined in the inspection policy.
                            items:
                              description: FollowupActionEnforcement indicates what
                                followup actions defined in the inspection configuration
                                are applied.
                              properties:
                                action:
                                  description: FollowupAction defines what actions
                                    should be applied when security expectations are
                                    matched.
                                  properties:
                                    ignore:
                                      description: Ignore applying actions to the
                                        workloads with the specified labels.
                                      properties:
                                        matchExpressions:
                                          description: matchExpressions is a list
                                            of label selector requirements. The requirements
                                            are ANDed.
                                          items:
                                            description: A label selector requirement
                                              is a selector that contains values,
                                              a key, and an operator that relates
                                              the key and values.
                                            properties:
                                              key:
                                                description: key is the label key
                                                  that the selector applies to.
                                                type: string
                                              operator:
                                                description: operator represents a
                                                  key's relationship to a set of values.
                                                  Valid operators are In, NotIn, Exists
                                                  and DoesNotExist.
                                                type: string
                                              values:
                                                description: values is an array of
                                                  string values. If the operator is
                                                  In or NotIn, the values array must
                                                  be non-empty. If the operator is
                                                  Exists or DoesNotExist, the values
                                                  array must be empty. This array
                                                  is replaced during a strategic merge
                                                  patch.
                                                items:
                                                  type: string
                                                type: array
                                            required:
                                            - key
                                            - operator
                                            type: object
                                          type: array
                                        matchLabels:
                                          additionalProperties:
                                            type: string
                                          description: matchLabels is a map of {key,value}
                                            pairs. A single {key,value} in the matchLabels
                                            map is equivalent to an element of matchExpressions,
                                            whose key field is "key", the operator
                                            is "In", and the values array contains
                                            only "value". The requirements are ANDed.
                                          type: object
                                      type: object
                                    kind:
                                      description: Kind of action.
                                      enum:
                                      - forbid_vulnerable_deployment
                                      - quarantine_vulnerable_workload
                                      - alert
                                      type: string
                                    settings:
                                      additionalProperties:
                                        type: string
                                      description: Settings of the action.
                                      type: object
                                  required:
                                  - kind
                                  type: object
                                result:
                                  description: EnforcementResult keeps the result
                                    of policy enforcement.
                                  properties:
                                    error:
                                      type: string
                                    status:
                                      enum:
                                      - applied
                                      - failed
                                      - dirty
                                      type: string
                                  required:
                                  - status
                                  type: object
                              required:
                              - action
                              - result
                              type: object
                            type: array
                          failures:
                            description: Keep all the failures of the assessment when
                              passed is false.
                            items:
                              description: AssessmentFailure defines failures of the
                                assessment.
                              properties:
                                assessmentError:
                                  description: What error occurred?
                                  properties:
                                    cause:
                                      type: string
                                    code:
                                      format: int32
                                      type: integer
                                    error:
                                      type: string
                                  required:
                                  - error
                                  type: object
                                baseline:
                                  description: For which compliance baseline? If no
                                    compliance baseline specified, that means other
                                    failure happened before doing data assessment.
                                  properties:
                                    baseline:
                                      description: Baseline for the compliance of
                                        this kind.
                                      type: string
                                    kind:
                                      description: Kind of inspector.
                                      enum:
                                      - vulnerability
                                      - malware
                                      - misconfiguration
                                      - license
                                      - BOM
                                      type: string
                                    scheme:
                                      description: Scheme of data.
                                      type: string
                                    version:
                                      description: Version of data scheme used for
                                        the compliance check.
                                      type: string
                                  required:
                                  - baseline
                                  - kind
                                  - scheme
                                  - version
                                  type: object
                                container:
                                  description: For which container (image)?
                                  properties:
                                    id:
                                      description: ID of the container.
                                      type: string
                                    image:
                                      description: Image of the container.
                                      type: string
                                    imageID:
                                      description: ImageID of the container.
                                      type: string
                                    isInit:
                                      description: IsInit indicate if the container
                                        is an init container.
                                      type: boolean
                                    name:
                                      description: Name of the container.
                                      type: string
                                  required:
                                  - id
                                  - image
                                  - imageID
                                  - isInit
                                  - name
                                  type: object
                              required:
                              - assessmentError
                              - container
                              type: object
                            type: array
                          passed:
                            description: Indicates if all the compliance checks are
                              passed.
                            type: boolean
                          workload:
                            description: For which workload is assessing?
                            properties:
                              metadata:
                                description: For pure Pod, no object reference.
                                properties:
                                  apiVersion:
                                    description: API version of the referent.
                                    type: string
                                  fieldPath:
                                    description: 'If referring to a piece of an object
                                      instead of an entire object, this string should
                                      contain a valid JSON/Go field access statement,
                                      such as desiredState.manifest.containers[2].
                                      For example, if the object reference is to a
                                      container within a pod, this would take on a
                                      value like: "spec.containers{name}" (where "name"
                                      refers to the name of the container that triggered
                                      the event) or if no container name is specified
                                      "spec.containers[2]" (container with index 2
                                      in this pod). This syntax is chosen only to
                                      have some well-defined way of referencing a
                                      part of an object. TODO: this design is not
                                      final and this field is subject to change in
                                      the future.'
                                    type: string
                                  kind:
                                    description: 'Kind of the referent. More info:
                                      https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
                                    type: string
                                  name:
                                    description: 'Name of the referent. More info:
                                      https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names'
                                    type: string
                                  namespace:
                                    description: 'Namespace of the referent. More
                                      info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/'
                                    type: string
                                  resourceVersion:
                                    description: 'Specific resourceVersion to which
                                      this reference is made, if any. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency'
                                    type: string
                                  uid:
                                    description: 'UID of the referent. More info:
                                      https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids'
                                    type: string
                                type: object
                              pods:
                                description: Pods of this workload.
                                items:
                                  description: Pod for representing kubernetes Pod.
                                  properties:
                                    containers:
                                      description: Containers of the pod.
                                      items:
                                        description: Container for representing kubernetes
                                          Container.
                                        properties:
                                          id:
                                            description: ID of the container.
                                            type: string
                                          image:
                                            description: Image of the container.
                                            type: string
                                          imageID:
                                            description: ImageID of the container.
                                            type: string
                                          isInit:
                                            description: IsInit indicate if the container
                                              is an init container.
                                            type: boolean
                                          name:
                                            description: Name of the container.
                                            type: string
                                        required:
                                        - id
                                        - image
                                        - imageID
                                        - isInit
                                        - name
                                        type: object
                                      type: array
                                    metadata:
                                      description: "ObjectReference contains enough
                                        information to let you inspect or modify the
                                        referred object. --- New uses of this type
                                        are discouraged because of difficulty describing
                                        its usage when embedded in APIs.  1. Ignored
                                        fields.  It includes many fields which are
                                        not generally honored.  For instance, ResourceVersion
                                        and FieldPath are both very rarely valid in
                                        actual usage.  2. Invalid usage help.  It
                                        is impossible to add specific help for individual
                                        usage.  In most embedded usages, there are
                                        particular     restrictions like, \"must refer
                                        only to types A and B\" or \"UID not honored\"
                                        or \"name must be restricted\".     Those
                                        cannot be well described when embedded.  3.
                                        Inconsistent validation.  Because the usages
                                        are different, the validation rules are different
                                        by usage, which makes it hard for users to
                                        predict what will happen.  4. The fields are
                                        both imprecise and overly precise.  Kind is
                                        not a precise mapping to a URL. This can produce
                                        ambiguity     during interpretation and require
                                        a REST mapping.  In most cases, the dependency
                                        is on the group,resource tuple     and the
                                        version of the actual struct is irrelevant.
                                        \ 5. We cannot easily change it.  Because
                                        this type is embedded in many locations, updates
                                        to this type     will affect numerous schemas.
                                        \ Don't make new APIs embed an underspecified
                                        API type they do not control. \n Instead of
                                        using this type, create a locally provided
                                        and used type that is well-focused on your
                                        reference. For example, ServiceReferences
                                        for admission registration: https://github.com/kubernetes/api/blob/release-1.17/admissionregistration/v1/types.go#L533
                                        ."
                                      properties:
                                        apiVersion:
                                          description: API version of the referent.
                                          type: string
                                        fieldPath:
                                          description: 'If referring to a piece of
                                            an object instead of an entire object,
                                            this string should contain a valid JSON/Go
                                            field access statement, such as desiredState.manifest.containers[2].
                                            For example, if the object reference is
                                            to a container within a pod, this would
                                            take on a value like: "spec.containers{name}"
                                            (where "name" refers to the name of the
                                            container that triggered the event) or
                                            if no container name is specified "spec.containers[2]"
                                            (container with index 2 in this pod).
                                            This syntax is chosen only to have some
                                            well-defined way of referencing a part
                                            of an object. TODO: this design is not
                                            final and this field is subject to change
                                            in the future.'
                                          type: string
                                        kind:
                                          description: 'Kind of the referent. More
                                            info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
                                          type: string
                                        name:
                                          description: 'Name of the referent. More
                                            info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names'
                                          type: string
                                        namespace:
                                          description: 'Namespace of the referent.
                                            More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/'
                                          type: string
                                        resourceVersion:
                                          description: 'Specific resourceVersion to
                                            which this reference is made, if any.
                                            More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency'
                                          type: string
                                        uid:
                                          description: 'UID of the referent. More
                                            info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids'
                                          type: string
                                      type: object
                                  required:
                                  - containers
                                  - metadata
                                  type: object
                                type: array
                            required:
                            - metadata
                            - pods
                            type: object
                        required:
                        - passed
                        - workload
                        type: object
                      type: array
                  required:
                  - namespace
                  - workloadAssessments
                  type: object
                type: array
            required:
            - inspectionConfiguration
            - namespaceAssessments
            type: object
          status:
            description: AssessmentReportStatus defines the observed state of AssessmentReport
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
